# 软路由与NAS 软件平台搭建

2018年秋冬之交（双十一前后），我自己用工控主板搭了一个软路由和 NAS 的一个硬件平台，详见这篇文章 [软路由与NAS 软件平台搭建](./2018-11-02-router1_hardware.md)。但其实，那只是有了一个机子，真正要实现软路由和 NAS 的功能，还需要一些软件的支持。

所以这篇文章来讲讲这小东西软件平台的搭建历程...

## 操作系统

首先是使用怎么样的操作系统作为这台机子的主要平台呢？这个问题其实没有多少答案，而且我之前也已经想好了。首先，不像尹大人那样那么会玩，我甚至没法想象去使用什么 Windows Server 来搞事情，也没听过什么 RouterOS 。所以其实，软路由部分肯定需要由 OpenWrt 来承载。 NAS 的话我的要求比较简单，就是能够通过网络访问、读写我那块 1T 硬盘里的数据就可以，性能最好能跟直接插上硬盘传差不多（这是不可能的），所以最简单的，就用 SMB 就行。 OpenWrt 也可以跑 SMB 。

再想想还能有什么应用？其实不管是什么，我能想到的，基本上 OpenWrt 都可以，那么就开始安装 OpenWrt 吧。当然不要！虽然我也不知道为什么，也许只是因为我比较菜，我觉得如果有个图形界面会好很多。而且一个中规中矩的 Linux 系统可能会比较易于使用，而且而且 opkg 实在不如 apt 好用，所以我还是很希望能安装一个 Ubuntu 什么的。但 OpenWrt 肯定是需要的，所以最终方案就是

**Ubuntu Desktop 18.04 + VM (OpenWrt)**

了

Ubuntu 就直接官网下载安装就好了，没什么技术含量，也没有坑，不值一提。由于官方编译好的 x86_64 的 OpenWrt 磁盘镜像完全不能符合我的需求，比如他甚至没有我那块无线网卡（QCA9880）的驱动，所以自己编译一个肯定是逃不了了。为了按照时间顺序记叙，我把这一部分留到后面再讲 （见 *OpenWrt 编译* ）






---

## 后记

最开始真正接触软路由，是大二的时候，在科协。尹大人在一台老旧的主机上跑个 OpenWrt ，那个机子有四个网卡（两LAN两WAN）。两个WAN一个走翼讯出，一个走校园网出，两个LAN接两个无线AP。效果就是睿思等校内流量走校园网，其他流量走翼讯，两个WiFi中一个是普通的，一个是带透明代理（可以访问国际互联网那种）的。初见很是惊奇，未曾想过竟能如此优雅地配置网络。

再后来，尹大人把它配置得更复杂了，把 OpenWrt 装进虚拟机里，四个网卡桥接进虚拟机里。

那时的我，刚好大一结束的暑假刚看完一本计算机网络的入门教材（也是尹大人推荐的，《计算机网络 自顶向下方法》），对计算机网络充满兴趣。而 OpenWrt 在那时的我看来是一个完美的学习平台，可以检验我对很多计算机网络基础知识的认识。所以从那时起我就慢慢玩起了 OpenWrt 